// modules/trading-ebooks/script.js

const bookData = {
Â  Â  'comeback-trader': {
Â  Â  Â  Â  title: 'The Comeback Trader',
Â  Â  Â  Â  summary: 'Lost ground in the markets? This guide is your blueprint to turn setbacks into setups. Master emotional resilience, refine your strategy, and rebuild your capital with proven insights. Your comeback starts here. This book offers actionable strategies, psychological tools, and a clear path to regaining control of your trading journey.',
Â  Â  Â  Â  // FIX: Removed '&autoplay=1' to allow the video to play consistently in the modal
Â  Â  Â  Â  videoUrl: 'https://www.youtube.com/embed/nOelEsu0toI?rel=0&modestbranding=1',Â 
Â  Â  Â  Â  gumroadUrl: 'https://tradersgazette.gumroad.com/l/TheComebackTrader',
Â  Â  Â  Â  coverUrl: 'https://github.com/Ozz310/tradersgazetteterminal/blob/main/images/Gemini_Generated_Image_hczk8shczk8shczk.png?raw=true'
Â  Â  }
Â  Â  // Add more books here later
};

/**
Â * Initializes the Ebooks module: attaches event listeners to gallery cards
Â * to open the modal and handles modal opening/closing logic.
Â */
function initEbooks() {
Â  Â  const modal = document.getElementById('ebook-modal');
Â  Â  const closeBtn = document.querySelector('.trading-ebooks .close-button');
Â  Â  const galleryCards = document.querySelectorAll('.trading-ebooks .gallery-card');

Â  Â  if (!modal || galleryCards.length === 0) {
Â  Â  Â  Â  // If elements are not found when called, exit without error.
Â  Â  Â  Â  return false;Â 
Â  Â  }
Â  Â Â 
Â  Â  /**
Â  Â  Â * Fills and opens the modal with specific book data.
Â  Â  Â */
Â  Â  function openModal(bookId) {
Â  Â  Â  Â  const book = bookData[bookId];
Â  Â  Â  Â  if (!book) return;

Â  Â  Â  Â  const modalBody = document.getElementById('modal-body');
Â  Â  Â  Â Â 
Â  Â  Â  Â  modalBody.innerHTML = `
Â  Â  Â  Â  Â  Â  <h2 class="book-title-modal">${book.title}</h2>
Â  Â  Â  Â  Â  Â  <div class="book-video-container">
Â  Â  Â  Â  Â  Â  Â  Â  <iframeÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  src="${book.videoUrl}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="${book.title} Trailer"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frameborder="0"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allowfullscreen>
Â  Â  Â  Â  Â  Â  Â  Â  </iframe>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p>${book.summary}</p>
Â  Â  Â  Â  Â  Â  <a href="${book.gumroadUrl}" target="_blank" class="buy-button">
Â  Â  Â  Â  Â  Â  Â  Â  Purchase on Gumroad
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  `;
Â  Â  Â  Â  modal.classList.add('open');
Â  Â  }

Â  Â  /**
Â  Â  Â * Closes the modal and stops the video playback.
Â  Â  Â */
Â  Â  function closeModal() {
Â  Â  Â  Â  const iframe = modal.querySelector('iframe');
Â  Â  Â  Â  if (iframe) {
Â  Â  Â  Â  Â  Â  iframe.src = '';Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  modal.classList.remove('open');
Â  Â  }

Â  Â  // Attach click listeners to all gallery cards
Â  Â  galleryCards.forEach(card => {
Â  Â  Â  Â  // Prevent duplicate listeners from previous initialization attempts
Â  Â  Â  Â  card.removeEventListener('click', card.clickHandler);Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  card.clickHandler = (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  Â  Â  const bookId = card.getAttribute('data-book-id');
Â  Â  Â  Â  Â  Â  openModal(bookId);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  card.addEventListener('click', card.clickHandler);
Â  Â  });

Â  Â  // Attach listeners for closing the modal
Â  Â  if (closeBtn) {
Â  Â  Â  Â  closeBtn.addEventListener('click', closeModal);
Â  Â  }
Â  Â Â 
Â  Â  window.addEventListener('click', (event) => {
Â  Â  Â  Â  if (event.target === modal) {
Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  }
Â  Â  });
Â  Â Â 
Â  Â  document.addEventListener('keydown', (event) => {
Â  Â  Â  Â  if (event.key === 'Escape' && modal.classList.contains('open')) {
Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  }
Â  Â  });

Â  Â  console.log('Ebooks module initialized successfully.');
Â  Â  return true;
}

// ðŸ’¥ FINAL DEFINITIVE FIX: Use three-pronged initialization to reliably execute the scriptÂ 
// regardless of complex router loading order.

// 1. Call on DOMContentLoaded (Standard practice)
document.addEventListener('DOMContentLoaded', initEbooks);

// 2. Call immediately (Catches cases where the script is loaded and executed late, but the module is present)
initEbooks();

// 3. Call after a slight delay (Catches cases where the router injects the module AFTER DOMContentLoaded)
setTimeout(initEbooks, 200);

console.log('Ebooks module script running with multiple initialization attempts.');
